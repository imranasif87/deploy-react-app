import{b as a,a5 as E,c as n,j as e,K as N,B as L,u as z,A as D,ay as j,e as R,n as T}from"./index-04fc7d56.js";/* empty css              */import{d as $,a as B}from"./VisibilityOff-81e0d5d9.js";import{T as M}from"./TextField-b77e99c3.js";import{F as U,O}from"./OutlinedInput-ed327864.js";import{I as Z}from"./Select-2f2e7d44.js";import{S as V}from"./Stack-83892a09.js";import{A as W}from"./Alert-0bf56b7a.js";import"./InputBase-d61b863a.js";import"./Input-3dc7ac4d.js";const q=f=>{const{formData:i,onChange:s,onSubmit:h}=f,{Email:l,IsAdmin:k,Role:P,Password:x}=i,[p,g]=a.useState(l),[d,c]=E.useState(!1),w=()=>c(r=>!r),m=r=>{r.preventDefault()};return a.useEffect(()=>{g(l)},[l]),n("div",{className:"login-form",children:[e("div",{children:e("h1",{children:"Logg inn"})}),n("form",{className:"form__login",onSubmit:h,children:[n("div",{className:"form__login__column",children:[e("label",{htmlFor:"Email",children:"E-post"}),e("br",{}),e(M,{style:{width:"300px",backgroundColor:"white"},className:"input-email",id:"Email",size:"small",name:"Email",type:"email",value:p,onChange:r=>{g(r.target.value),s(r)},pattern:"^[a-zA-Z0-9._%+-]+@[a-zA-Z0-9.-]+\\.[a-zA-Z]{2,}$",required:!0}),e("div",{})]}),n("div",{className:"form__login__column",children:[e("label",{htmlFor:"Password",children:"Passord"}),e("br",{}),n(U,{variant:"outlined",children:[e(Z,{sx:{width:"25ch"},htmlFor:"outlined-adornment-password"}),e(O,{id:"Password",type:d?"text":"password",style:{width:"300px",backgroundColor:"white"},className:"input-password",name:"Password",value:x,onChange:s,pattern:"^(?=.*\\d{2,})(?=.*[A-Z]).{2,31}$",maxLength:31,required:!0,size:"small",endAdornment:e(N,{"aria-label":"toggle password visibility",onClick:w,onMouseDown:m,edge:"end",children:d?e($,{}):e(B,{})})})]}),e("div",{})]}),e(L,{type:"submit",variant:"contained",style:{width:"300px",border:"1px solid white",color:"white",backgroundColor:"#00602C"},sx:{":hover":{backgroundColor:"#369E3B"},margin:1},children:"Logg inn"})]})]})},G={Person:{FirstName:"",LastName:"",Email:"",Phone:""},IsAdmin:!1,Role:"",Password:""},ae=f=>{const i=z(),[s,h]=a.useState({email:"",password:""}),[l,k]=a.useState("no"),P=l==="en"?R.login:T.login,[x,p]=a.useState(""),[g,d]=a.useState(""),[c,w]=a.useState(!1),[m,r]=a.useState(null),C=(t,u=/$^/)=>{const{name:o,value:v}=t.target;h(y=>({...y,Person:{...y.Person,[o]:v}}))},b=async(t,u)=>{const o=await fetch("https://wideroeemergencynextofkinapi.azure-api.net/WideroeEmergency/api/User/login",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({email:s.Person.Email,password:s.Person.Password})});if(o.status===200)return await o.json();if(o.status===404)return!1;if(o.status===401)return!1;throw new Error("Unexpected error occurred")},S=async t=>{t.preventDefault(),console.log(s),await b(s.Person.Email,s.Person.Password)?(F(),p(s.Person.Email),d(s.Person.Password)):r(e(W,{severity:"error",children:"Feil e-post eller passord. Vennligst prøv igjen."})),h(G),p(s.Person.Email),d(s.Person.Password)},_=()=>{w(!c)},{setIsAuthenticated:A}=a.useContext(D),F=async()=>{const t=await b(s.Person.Email,s.Person.Password);if(console.log("Token: ",t.token),t.token){c&&localStorage.setItem("token",t.token),localStorage.setItem("userId",t.userId),A(!0);const u=await fetch(`https://wideroeemergencynextofkinapi.azure-api.net/WideroeEmergency/api/User/${t.userId}`,{method:"GET",headers:{Authorization:`Bearer ${t.token}`}});if(u.status===200){const{role:o}=await u.json();o===0?i("/hrk_controlpanel"):o===1&&i("/")}else m("Failed to get user details")}else m("Ugyldig E-post eller passord")},I=()=>{i("/ForgotPassword")};return e(E.Fragment,{children:n("div",{id:"login",children:[e("img",{className:"navbar__img-item",src:j,alt:"Widerøe logo"}),e("div",{id:"login-container",children:e(q,{formData:s,onChange:C,onSubmit:S})}),e(V,{sx:{width:"25%",margin:"10px"},spacing:2,children:m}),n("div",{id:"login-text",style:{display:"inline-block",textAlign:"left"},children:[n("label",{children:[P.remember,e("input",{type:"checkbox",checked:c,onChange:_})]}),e("br",{}),e("span",{onClick:I,children:"Glemt passord?"})]})]})})};export{ae as default};
